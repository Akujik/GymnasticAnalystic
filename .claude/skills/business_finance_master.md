# business_finance_master

## 体操馆企业财务与经营分析师技能说明

### 角色定位
作为企业财务与经营数据分析师，负责系统性诊断体操馆所有经营环节与财务链路，输出每一关键数据指标与诊断结论。结果统一输出为 Markdown 看板。

***

### 业务与财务分析项目列表

#### 1. 体验课分析
- 体验课上课总人数（可分周期/老师/年龄）
- 体验课转化率（按时间、老师、年龄等分组）
- 提供转换公式与数据缺失说明

#### 2. 会员全览
- 会员总人数
- 分年龄段会员人数（如 3-6岁、7-9岁、10-12岁、13岁及以上/未知）
- 可切片分析各期/渠道流量

#### 3. 消课情况
- 总消课小时数（按周期/老师/等级/年龄分组）
- 总消课金额
- 未消课金额和人数分布（理论与实际未消课对比，含分年龄/老师/班级）
- 数据缺失部分给出估算公式，并单独标记

#### 4. 周上课人次
- 每周总上课人次
- 按班级、分年龄、分老师拆分

#### 5. 班均人数
- 本周期各班级平均人数
- 可输出各班级/课程类型的对比表

#### 6. 到课率
- 按月/周/老师/班级汇总实际到课率
- 公式与数据缺失解释

#### 7. 低消人员流失预警
- 近周期低消名单
- 按年龄段分布
- 推算未来流失预警，并有缺失数据说明

#### 8. 用户留存率
- 月/季度/年度留存率
- 重要生命周期切片（如体验→正式、续费等关键转折）
- 输出全面留存分析

#### 9. 用户平均生命周期
- 明确生命周期定义
- 各阶段人数与周期分布

#### 10. 用户 LTV（生命周期价值）
- 按不同课时包/类型计算 LTV
- 输出分年龄/分渠道 LTV

#### 11. 现金流情况（实充金额、未消课负债/资产）
- 新生报名/老生续费充值金额（含分周期、分渠道）
- 账户现金流总览与当期资产负债推算

#### 12. 报名/退费情况
- 新增正式会员数
- 老生续费人数
- 退费人数及金额（分周期/分渠道）
- 新老生分别展示，并有缺失项说明

#### 13. 用户剩余金额
- 当前所有用户账户余额
- 剩余课时包金额，分渠道/年龄/老师分布

#### 14. 教师班级课时统计
- 每位教师各类型班级的上课次数（用于薪资及课时费推算）
- 当月/季度/年度明细

***

### 财务报表项目

#### 15. 三张财务报表自动生成
- 资产负债表（现金、应收、预收、固定资产、负债、所有者权益）
- 利润表（营业收入、成本明细、期间费用、净利润）
- 现金流量表（经营活动、筹资活动、投资活动现金变动）

#### 16. 财务健康度与诊断
- 负债率、毛利率、净利率、流动比率等主要财务指标自动评分
- 经营现金流缺口、预收账款风险、成本结构异常自动诊断

#### 17. 财务预测（销售百分比法）
- 按历史销售数据，自动预测销售增长、利润增长、融资需求
- 多情景敏感性分析（如：销售增长10%、成本下降5%等）

#### 18. 经营细节拆解与优化建议
- 场地利用率（时段/班级/老师端对比）
- 教练人效、单课时产出、人均成效
- 获客/转化流程瓶颈诊断与改进建议

#### 19. 数据缺失诊断与元数据说明
- 对所有项目标注数据缺失类型
- 影响分析范围与补录建议
- 估算公式与推算逻辑全部附注、可溯源

***

### 技能执行及输出规范

- **所有分析项目、报表与看板可按时间、老师、班级、年龄等维度任意切片输出**
- **如有数据缺失，自动输出"缺失项说明"及推算公式**
- **每条业务与财务指标都带元数据解释**
- **结果全部产出 Markdown 格式文档，适用于日常复盘与报告**

### 🚨 核心约束条件（必须遵守）

#### 1. 每次执行重新获取最新数据
- **严禁使用缓存数据** - 每次执行必须重新从飞书API获取
- **强制刷新访问令牌** - 每次都获取新的飞书访问令牌
- **数据新鲜度验证** - 确保数据时间戳为最新

#### 2. 完整分页处理（禁止截断）
- **循环获取所有页面** - 检查 `has_more` 字段，直到返回 `false`
- **自动分页处理** - 处理 `page_token` 进行分页请求
- **数据完整性验证** - 使用工具检查是否有数据截断
- **进度监控** - 记录获取的页数和记录总数

#### 3. 标准文件夹结构
- **强制目录结构** - 必须按以下结构保存文件：
  ```
  /Users/cc/Documents/feishu/
  ├── results/
  │   ├── data/           # 原始数据
  │   ├── analysis/       # 分析数据
  │   └── reports/        # 最终报告
  ├── logs/               # 执行日志
  └── temp/               # 临时文件
  ```
- **标准文件命名** - `gymnastics_business_analysis_YYYYMMDD_HHMMSS.md`
- **报告位置** - 必须保存到 `results/reports/` 目录

### ⛔ 禁止操作
- ❌ 使用任何缓存的历史数据
- ❌ 忽略分页只获取部分数据
- ❌ 将报告保存到根目录或其他错误位置
- ❌ 跳过数据质量验证步骤
- ❌ 使用不规范的文件命名

### ✅ 成功标准
执行成功必须满足：
- [ ] 重新获取了最新的飞书数据（非缓存）
- [ ] 完整获取了两个表格的所有数据（无分页截断）
- [ ] 按标准目录结构保存了所有文件
- [ ] 生成了完整的8章节专业分析报告
- [ ] 记录了详细的执行日志

***

### 增强版飞书数据获取方案

为确保数据完整性和准确性，本技能使用以下增强版数据获取方案：

#### 🚀 自动完整分页获取
```bash
# 使用增强版数据获取脚本
node lark_mcp_robust.js
```

#### 📊 数据完整性验证
- ✅ 自动检测数据完整性（100%验证）
- ✅ 断点续传支持，防止数据丢失
- ✅ 多页自动循环，确保获取全部记录
- ✅ 进度跟踪和实时反馈

#### 🔧 技术特性
- **分页循环**: 自动处理所有页面直到 has_more = false
- **错误重试**: 网络问题自动重试机制
- **断点续传**: 支持中断后继续获取
- **数据验证**: 确保获取到预期数量的记录
- **进度监控**: 实时显示获取进度

#### 📋 预期数据量
- **业务数据**: 约2,589条记录（完整）
- **财务数据**: 约1,049条记录（完整）
- **时间范围**: 2024年12月18日 - 最新日期

#### ⚠️ 数据完整性检查
每次数据获取后会自动验证：
1. 记录数量匹配检查
2. 数据完整性验证
3. 时间范围覆盖检查
4. 关键字段完整性检查

#### 🔄 数据获取流程
1. **连接飞书API**: 使用最新访问令牌
2. **完整分页获取**: 自动循环所有页面
3. **实时进度反馈**: 显示每页获取进度
4. **数据验证**: 确保100%数据完整性
5. **备份保存**: 同时保存完整数据和检查点

### 🚀 极简数据获取方案

采用一体化脚本，解决分页数据丢失问题：

#### 📊 核心脚本
```bash
# 一键完成数据获取和分析
node fetch_and_analyze.js
```

#### ✅ 技术保障
- **完整分页**: 自动获取所有页面数据，无遗漏
- **100%数据**: 确保业务2,589条 + 财务1,049条完整获取
- **错误重试**: 网络问题自动重试机制
- **进度监控**: 实时显示获取进度

### 📁 简化文件管理

采用极简的文件管理方案，避免复杂的文件夹结构：

#### 🗂️ 文件结构
```
results/                           # 唯一结果目录
├── business_data_20251112_143022.json   # 业务数据
├── finance_data_20251112_143022.json    # 财务数据
├── analysis_20251112_143022.json        # 分析数据
└── report_20251112_143022.md           # 分析报告
```

#### ⏰ 命名规范
- **统一时间戳**: `YYYYMMDD_HHMMSS` 格式
- **文件类型**: 前缀清晰标识文件类型
- **自动管理**: 每次分析生成新的时间戳文件

#### 🔧 技术特性
- **100%数据获取**: 完整分页，确保无遗漏
- **一体化脚本**: 一个脚本完成数据获取和分析
- **简单执行**: 无需复杂配置，一键运行
- **自动清理**: 根目录保持整洁

### 使用方法

#### 最简单方式（推荐）
```bash
node fetch_and_analyze.js
```

#### 技能调用
直接输入： "请使用business_finance_master技能分析体操馆的财务和经营数据"

#### 命令行
输入： `/business-analysis`

### ⚠️ 重要提醒
- 所有文件统一保存在 `results/` 目录下
- 根目录不再产生混乱文件
- 查看最新报告： `ls -lt results/report_*.md | head -1`
- 历史文件便于对比和回溯
- 每次运行都是独立分析，互不干扰